from pyspark.sql import SparkSession
from pyspark.sql.functions import year, avg

# Create SparkSession
spark = SparkSession.builder \
    .appName("Yearly Trend Analysis") \
    .getOrCreate()

# Assuming trust_df is already created with the data

# Extract year from Period column
trust_df = trust_df.withColumn("Year", year("Period"))

# Group by Year and calculate average Type1_Departments_Major_A&E value
trend_analysis_df = trust_df.groupBy("Year") \
    .agg(avg("Type1_Departments_Major_A&E").alias("Avg_Type1_Departments_Major_A&E"))

# Show the trend analysis
trend_analysis_df.orderBy("Year").show()

# Stop SparkSession
spark.stop()
