from pyspark.sql import SparkSession
from pyspark.sql.functions import approxQuantile, year

# Create SparkSession
spark = SparkSession.builder \
    .appName("Yearly Trend Analysis - Median") \
    .getOrCreate()

# Assuming trust_df is already created with the data

# Extract year from Period column
trust_df = trust_df.withColumn("Year", year("Period"))

# Group by Year and calculate median Type1_Departments_Major_A&E value
quantiles = trust_df.groupby("Year")\
                    .agg(approxQuantile("Type1_Departments_Major_A&E", [0.5], 0.0).alias("Median_Type1_Dept_Major_A&E_attd"))

# Show the trend analysis
quantiles.orderBy("Year").show()




import pandas as pd
import matplotlib.pyplot as plt

# Convert Spark DataFrame to Pandas DataFrame
trend_analysis_pd = trend_analysis_df.toPandas()

# Plotting
plt.figure(figsize=(10, 6))
plt.plot(trend_analysis_pd['Year'], trend_analysis_pd['Avg_Type1_Departments_Major_A&E'], marker='o', linestyle='-')
plt.title('Yearly Trend Analysis of Type1_Departments_Major_A&E')
plt.xlabel('Year')
plt.ylabel('Average Type1_Departments_Major_A&E')
plt.grid(True)
plt.xticks(trend_analysis_pd['Year'])
plt.tight_layout()
plt.show()
